Alter table ProgramFolders add [IsActive] bit  NOT NULL default(1)


-- Creating table 'PrimeContractors'
CREATE TABLE [dbo].[PrimeContractors] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [Name] nvarchar(max)  NOT NULL,
    [IsActive] bit  NOT NULL
);
GO

-- Creating table 'InventoriedBies'
CREATE TABLE [dbo].[InventoriedBies] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [Name] nvarchar(max)  NOT NULL,
    [IsActive] bit  NOT NULL
);
GO

-- Creating table 'AwardingAgencies'
CREATE TABLE [dbo].[AwardingAgencies] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [Name] nvarchar(max)  NOT NULL,
    [IsActive] bit  NOT NULL
);
GO

-- Creating table 'AwardingOffices'
CREATE TABLE [dbo].[AwardingOffices] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [Name] nvarchar(max)  NOT NULL,
    [IsActive] bit  NOT NULL
);
GO

-- Creating table 'DepartmentOfRecordsCoordinators'
CREATE TABLE [dbo].[DepartmentOfRecordsCoordinators] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [Name] nvarchar(max)  NOT NULL,
    [IsActive] bit  NOT NULL
);
GO


-- Creating primary key on [Id] in table 'PrimeContractors'
ALTER TABLE [dbo].[PrimeContractors]
ADD CONSTRAINT [PK_PrimeContractors]
    PRIMARY KEY CLUSTERED ([Id] ASC);
GO

-- Creating primary key on [Id] in table 'InventoriedBies'
ALTER TABLE [dbo].[InventoriedBies]
ADD CONSTRAINT [PK_InventoriedBies]
    PRIMARY KEY CLUSTERED ([Id] ASC);
GO

-- Creating primary key on [Id] in table 'AwardingAgencies'
ALTER TABLE [dbo].[AwardingAgencies]
ADD CONSTRAINT [PK_AwardingAgencies]
    PRIMARY KEY CLUSTERED ([Id] ASC);
GO

-- Creating primary key on [Id] in table 'AwardingOffices'
ALTER TABLE [dbo].[AwardingOffices]
ADD CONSTRAINT [PK_AwardingOffices]
    PRIMARY KEY CLUSTERED ([Id] ASC);
GO

-- Creating primary key on [Id] in table 'DepartmentOfRecordsCoordinators'
ALTER TABLE [dbo].[DepartmentOfRecordsCoordinators]
ADD CONSTRAINT [PK_DepartmentOfRecordsCoordinators]
    PRIMARY KEY CLUSTERED ([Id] ASC);
GO



ALTER TABLE [dbo].[Programs] drop CONSTRAINT [FK_ProgramAwardingAgency]
ALTER TABLE [dbo].[Programs] drop CONSTRAINT [FK_ProgramContact]
ALTER TABLE [dbo].[Programs] drop CONSTRAINT [FK_ProgramInventoriedBy]
ALTER TABLE [dbo].[Programs] drop CONSTRAINT [FK_ProgramPrimeContractor]
ALTER TABLE [dbo].[Programs] drop CONSTRAINT [FK_ProgramContact1]


insert into [PrimeContractors] 
select distinct c.Name,1 from Programs p join Contacts c on p.PrimeContractor_Id=c.Id where c.Name!= ''
insert into InventoriedBies 
select distinct c.Name,1 from Programs p join Contacts c on p.InventoriedBy_Id=c.Id where c.Name!= ''
insert into [AwardingAgencies] 
select distinct c.Name,1 from Programs p join Contacts c on p.AwardingAgency_Id=c.Id where c.Name!= ''
insert into [AwardingOffices] 
select distinct c.Name,1 from Programs p join Contacts c on p.AwardingOffice_Id=c.Id where c.Name!= ''
insert into [DepartmentOfRecordsCoordinators] 
select distinct c.Name,1 from Programs p join Contacts c on p.DepartmentOfRecordsCoordinator_Id=c.Id where c.Name!= ''

update p set PrimeContractor_Id=null from Programs p join Contacts c on p.PrimeContractor_Id=c.Id where c.Name = ''
update p set InventoriedBy_Id=null from Programs p join Contacts c on p.InventoriedBy_Id=c.Id where c.Name = ''
update p set AwardingAgency_Id=null from Programs p join Contacts c on p.AwardingAgency_Id=c.Id where c.Name = ''
update p set AwardingOffice_Id=null  from Programs p join Contacts c on p.AwardingOffice_Id=c.Id where c.Name = ''
update p set DepartmentOfRecordsCoordinator_Id=null  from Programs p join Contacts c on p.DepartmentOfRecordsCoordinator_Id=c.Id where c.Name = ''

update p set PrimeContractor_Id=pc.Id from Programs p join Contacts c on p.PrimeContractor_Id=c.Id join PrimeContractors pc on pc.Name=c.name where c.Name!= ''
update p set AwardingAgency_Id=pc.Id from Programs p join Contacts c on p.AwardingAgency_Id=c.Id join AwardingAgencies pc on pc.Name=c.name where c.Name!= ''
update p set AwardingOffice_Id=pc.Id from Programs p join Contacts c on p.AwardingOffice_Id=c.Id join AwardingOffices pc on pc.Name=c.name where c.Name!= ''
update p set DepartmentOfRecordsCoordinator_Id=pc.Id from Programs p join Contacts c on p.DepartmentOfRecordsCoordinator_Id=c.Id join DepartmentOfRecordsCoordinators pc on pc.Name=c.name where c.Name!= ''
update p set InventoriedBy_Id=pc.Id from Programs p join Contacts c on p.InventoriedBy_Id=c.Id join InventoriedBies pc on pc.Name=c.name where c.Name!= ''

-- Creating foreign key on [PrimeContractor_Id] in table 'Programs'
ALTER TABLE [dbo].[Programs]
ADD CONSTRAINT [FK_ProgramPrimeContractor]
    FOREIGN KEY ([PrimeContractor_Id])
    REFERENCES [dbo].[PrimeContractors]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;
GO



-- Creating foreign key on [AwardingAgency_Id] in table 'Programs'
ALTER TABLE [dbo].[Programs]
ADD CONSTRAINT [FK_ProgramAwardingAgency]
    FOREIGN KEY ([AwardingAgency_Id])
    REFERENCES [dbo].[AwardingAgencies]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;
GO



-- Creating foreign key on [AwardingOffice_Id] in table 'Programs'
ALTER TABLE [dbo].[Programs]
ADD CONSTRAINT [FK_ProgramAwardingOffice]
    FOREIGN KEY ([AwardingOffice_Id])
    REFERENCES [dbo].[AwardingOffices]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;
GO


-- Creating foreign key on [DepartmentOfRecordsCoordinator_Id] in table 'Programs'
ALTER TABLE [dbo].[Programs]
ADD CONSTRAINT [FK_ProgramDepartmentOfRecordsCoordinator]
    FOREIGN KEY ([DepartmentOfRecordsCoordinator_Id])
    REFERENCES [dbo].[DepartmentOfRecordsCoordinators]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;
GO


-- Creating foreign key on [InventoriedBy_Id] in table 'Programs'
ALTER TABLE [dbo].[Programs]
ADD CONSTRAINT [FK_ProgramInventoriedBy]
    FOREIGN KEY ([InventoriedBy_Id])
    REFERENCES [dbo].[InventoriedBies]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;
GO

